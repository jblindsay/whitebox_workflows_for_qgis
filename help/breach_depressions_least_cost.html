<p>This tool can be used to perform a type of optimal depression breaching to prepare a digital elevation model (DEM) for hydrological analysis. Depression breaching is a common alternative to depression filling (<a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#fill_depressions">fill_depressions</a>) and often offers a lower-impact solution to the removal of topographic depressions. This tool implements a method that is loosely based on the algorithm described by Lindsay and Dhun (2015), furthering the earlier algorithm with efficiency optimizations and other significant enhancements. The approach uses a least-cost path analysis to identify the breach channel that connects pit cells (i.e. grid cells for which there is no lower neighbour) to some distant lower cell. Prior to breaching and in order to minimize the depth of breach channels, all pit cells are rised to the elevation of the lowest neighbour minus a small heigh value. Here, the cost of a breach path is determined by the amount of elevation lowering needed to cut the breach channel through the surrounding topography.</p> <p>The user must specify the name of the input DEM file (<code>dem</code>), the output breached DEM file (<code>output</code>), the maximum search window radius (<code>dist</code>), the optional maximum breach cost (<code>max_cost</code>), and an optional flat height increment value (<code>flat_increment</code>). Notice that <strong>if the <code>flat_increment</code> parameter is not specified, the small number used to ensure flow across flats will be calculated automatically, which should be preferred in most applications</strong> of the tool. The tool operates by performing a least-cost path analysis for each pit cell, radiating outward until the operation identifies a potential breach destination cell or reaches the maximum breach length parameter. If a value is specified for the optional <code>max_cost</code> parameter, then least-cost breach paths that would require digging a channel that is more costly than this value will be left unbreached. The flat increment value is used to ensure that there is a monotonically descending path along breach channels to satisfy the necessary condition of a downslope gradient for flowpath modelling. It is best for this value to be a small value. If left unspecified, the tool with determine an appropriate value based on the range of elevation values in the input DEM, <strong>which should be the case in most applications</strong>. Notice that the need to specify these very small elevation increment values is one of the reasons why the output DEM will always be of a 64-bit floating-point data type, which will often double the storage requirements of a DEM (DEMs are often store with 32-bit precision). Lastly, the user may optionally choose to apply depression filling (<code>fill</code>) on any depressions that remain unresolved by the earlier depression breaching operation. This filling step uses an efficient filling method based on flooding depressions from their pit cells until outlets are identified and then raising the elevations of flooded cells back and away from the outlets.</p> <p>The tool can be run in two modes, based on whether the <code>min_dist</code> is specified. If the <code>min_dist</code> flag is specified, the accumulated cost (accum<sub>2</sub>) of breaching from <em>cell1</em> to <em>cell2</em> along a channel issuing from <em>pit</em> is calculated using the traditional cost-distance function:</p> <blockquote> <p>cost<sub>1</sub> = z<sub>1</sub> - (z<sub>pit</sub> + <em>l</em> &times; <em>s</em>)</p> <p>cost<sub>2</sub> = z<sub>2</sub> - [z<sub>pit</sub> + (<em>l</em> + 1)<em>s</em>]</p> <p>accum<sub>2</sub> = accum<sub>1</sub> + <em>g</em>(cost<sub>1</sub> + cost<sub>2</sub>) / 2.0</p> </blockquote> <p>where cost<sub>1</sub> and cost<sub>2</sub> are the costs associated with moving through <em>cell1</em> and <em>cell2</em> respectively, z<sub>1</sub> and z<sub>2</sub> are the elevations of the two cells, z<sub>pit</sub> is the elevation of the pit cell, <em>l</em> is the length of the breach channel to <em>cell1</em>, <em>g</em> is the grid cell distance between cells (accounting for diagonal distances), and <em>s</em> is the small number used to ensure flow across flats. If the <code>min_dist</code> flag is not present, the accumulated cost is calculated as:</p> <blockquote> <p>accum<sub>2</sub> = accum<sub>1</sub> + cost<sub>2</sub></p> </blockquote> <p>That is, without the <code>min_dist</code> flag, the tool works to minimize elevation changes to the DEM caused by breaching, without considering the distance of breach channels. Notice that the value <code>max_cost</code>, if specified, should account for this difference in the way cost/cost-distances are calculated. The first cell in the least-cost accumulation operation that is identified for which cost<sub>2</sub> &lt;= 0.0 is the target cell to which the breach channel will connect the pit along the least-cost path.</p> <p>In comparison with the <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#breach_depressions_least_cost">breach_depressions_least_cost</a> tool, this breaching method often provides a more satisfactory, lower impact, breaching solution and is often more efficient. It is therefore advisable that users try the <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#breach_depressions_least_cost">breach_depressions_least_cost</a> tool to remove depressions from their DEMs first. This tool is particularly well suited to breaching through road embankments. There are instances when a breaching solution is inappropriate, e.g. when a very deep depression such as an open-pit mine occurs in the DEM and long, deep breach paths are created. Often restricting breaching with the <code>max_cost</code> parameter, combined with subsequent depression filling (<code>fill</code>) can provide an adequate solution in these cases. Nonetheless, there are applications for which full depression filling using the  <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#fill_depressions">fill_depressions</a> tool may be preferred.</p> <h2>Reference</h2> <p>Lindsay J, Dhun K. 2015. Modelling surface drainage patterns in altered landscapes using LiDAR. <em>International Journal of Geographical Information Science</em>, 29: 1-15. DOI: 10.1080/13658816.2014.975715</p> <h2>See Also</h2> <p><a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#breach_depressions_least_cost">breach_depressions_least_cost</a>, <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#fill_depressions">fill_depressions</a>, <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#cost_pathway">cost_pathway</a></p> <h2>Function Signature</h2> <p><code>def breach_depressions_least_cost(self, dem: Raster, max_cost: float = float('inf'), max_dist: int = 100, flat_increment: float = float('nan'), fill_deps: bool = False, minimize_dist: bool = False) -&gt; Raster: ... </code></p>
<h2>Project Links</h2>
<div align="left">
    <a href="https://www.whiteboxgeo.com/whitebox-workflows-for-python/">WbW Homepage</a>
    <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/preface.html">User Manual</a>
    <a href="https://www.whiteboxgeo.com/wbw-purchase/">Support WbW</a>
</div>        

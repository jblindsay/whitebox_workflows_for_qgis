<h2>License Information</h2> <p>Use of this function requires a license for Whitebox Workflows for Python Professional (WbW-Pro). Please visit <a href="https://www.whiteboxgeo.com/">www.whiteboxgeo.com</a> to purchase a license.</p> <h2>Description</h2> <p>This tool can be used to measure eigenvalue-based features that describe the characteristics of the local neighbourhood surrounding each point in an input LiDAR file (<code>input</code>). These features can then be used in point classification applications, or as the basis for point filtering (<a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#filter_lidar">filter_lidar</a>) or modifying point properties (<a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#modify_lidar">modify_lidar</a>).</p> <p>The algorithm begins by using the x, y, z coordinates of the points within a local spherical neighbourhood to calculate a <a href="https://en.wikipedia.org/wiki/Covariance_matrix">covariance matrix</a>. The three <a href="https://en.wikipedia.org/wiki/Eigenvalues_and_eigenvectors">eigenvalues</a> λ1, λ2, λ3 are then derived from the covariance matrix decomposition such that λ1 &gt; λ2 &gt; λ3. The eigenvalues are then used to describe the extent to which the neighbouring points can be characterized by a linear, planar, or volumetric distribution, by calculating the following three features:</p> <p>linearity = (λ<sub>1</sub> - λ<sub>2</sub>) / λ<sub>1</sub></p> <p>planarity = (λ<sub>2</sub> - λ<sub>3</sub>) / λ<sub>1</sub></p> <p>sphericity = λ<sub>3</sub> / λ<sub>1</sub></p> <p>In the case of a neighbourhood containing a 1-dimensional line, the first of the three components will possess most of data variance, with very little contained within λ<sub>2</sub> and λ<sub>3</sub>, and linearity will be nearly equal to 1.0. If the local neighbourhood contains a 2-dimensional plane, the first two components will possess most of the variance, with little variance within λ<sub>3</sub>, and planarity will be nearly equal to 1.0. Lastly, in the case of a 3-dimensional, random  volumetric point distribution, each of the three components will be nearly equal in magnitude and sphericity will be nearly equal to 1.0.</p> <p>Researchers in the field of LiDAR point classification also frequently define two additional eigenvalue-based features, the omnivariance (low values correspond to planar and linear regions and higher values occur for areas with a volumetric point distribution, such as vegetation), and the eigentropy, which is related to the Shannon entropy and is a measure of the unpredictability of the distribution of points in the neighbourhood:</p> <p>omnivariance = (λ<sub>1</sub> &#8901; λ<sub>2</sub> &#8901; λ<sub>3</sub>)<sup>1/3</sup></p> <p>eigentropy = -<em>e</em><sub>1</sub> &#8901; ln<em>e</em><sub>1</sub> - <em>e</em><sub>2</sub> &#8901; ln<em>e</em><sub>2</sub> - <em>e</em><sub>3</sub> &#8901; ln<em>e</em><sub>3</sub></p> <p>where <em>e</em><sub>1</sub>, <em>e</em><sub>2</sub>, and <em>e</em><sub>3</sub> are the normalized eigenvalues.</p> <p>In addition to the eigenvalues, the eigendecomposition of the symmetric covariance matrix also yields the three eigenvectors, which describe the transformation coefficients of the principal components. The first two eigenvectors represent the <a href="https://www.mathworks.com/help/stats/fitting-an-orthogonal-regression-using-principal-components-analysis.html">basis of the plane</a> resulting from the orthogonal regression analysis, while the third eigenvector represents the plane normal. From this normal, it is possible to calculate the slope of the plane, as well as the orthogonal distance between each point and the neighbourhood fitted plane, i.e. the point residual.</p> <p>This tool outputs a binary file (<em>.eigen; <code>output</code>) that contains a total of 10 features for each point in the input file, including the <code>point_num</code> (for reference), <code>lambda1</code>, <code>lambda2</code>, <code>lambda3</code>, <code>linearity</code>, <code>planarity</code>, <code>sphericity</code>, <code>omnivariance</code>, <code>eigentropy</code>, <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#slope">slope</a>, and <code>residual</code>. Users should bear in mind that most of these features describe the properties of the distribution of points within a spherical neighbourhood surrounding each point in the input file, rather than a characteristic of the point itself. The only one of the ten features that is a point property is the <code>residual</code>. Points for which the <code>planarity</code> value is high and the <code>residual</code> value is low may be assumed to be part of the plane that dominate the structure of their neighbourhoods. In addition to the binary data </em>.eigen file, the tool will also output a <a href="https://en.wikipedia.org/wiki/Sidecar_file">sidecar file</a>, with a *.eigen.json extension, which describes the structure of the raw binary data file.</p> <p>Local neighbourhoods are spherical in shape and the size of each neighbourhood is characterized by the <code>num_neighbours</code> and <code>radius</code> parameters. If the optional <code>num_neighbours</code> parameter is specified, the size of the neighbourhood will vary by point, increasing or decreasing to encompass the specified number of neighbours (notice that this value does not include the point itself). If the optional <code>radius</code> parameter is specified in addition to a number of neighbours, the specified radius value will serve as a upper-bound and neighbouring points that are beyond this radial distance to the centre point will be excluded. If a radius search distance is specified but the <code>num_neighbours</code> parameter is not, then a constant search distance will be used for each point in the input file, resulting in varying number of points within local neighbourhoods, depending on local point densities. If point density varies significantly in the input file, then use of the <code>num_neighbours</code> parameter may be advisable. Notice that at least one of the two parameters must be specified. In cases where the number of neighbouring points is fewer than eight, each of the output feature values will be set to 0.0.</p> <p>Note that if the user does not specify the optional input LiDAR file, the tool will search for all valid LiDAR (<em>.las, </em>.laz, *.zlidar) files contained within the current working directory. This feature can be useful for processing a large number of LiDAR files in batch mode.</p> <p>The binary data file (<em>.eigen) can be used directly by the <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#filter_lidar">filter_lidar</a> and <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#modify_lidar">modify_lidar</a> tools, and will be automatically read by the tools when the </em>.eigen and *.eigen.json files are present in the same folder as the accompanying source LiDAR file. This allows users to apply data filters, or to modify point properties, using these point neighbourhood features. For example, the statement, <code>rgb=(int(linearity*255), int(planarity*255), int(sphericity*255))</code>, used with the <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#modify_lidar">modify_lidar</a> tool, can render the point RGB colour values based on some of the eigenvalue features, allowing users to visually identify linear features (red), planar features (green), and volumetric regions (blue).</p> <p><img alt="" src="./img/LidarEigenvalueFeatures.png" /></p> <p>Additionally, these features data can also be readily incorporated into a Python-based point analysis or classification. As an example, the following script reads in a *.eigen binary data file for direct manipulation and analysis:</p> <p><code>import numpy as np</p> <p>dt = np.dtype([ ('point_num', '&lt;u8'), ('lambda1', '&lt;f4'), ('lambda2', '&lt;f4'), ('lambda3', '&lt;f4'), ('linearity', '&lt;f4'), ('planarity', '&lt;f4'), ('sphericity', '&lt;f4'), ('omnivariance', '&lt;f4'), ('eigentropy', '&lt;f4'), ('slope', '&lt;f4'), ('resid', '&lt;f4') ])</p> <p>with open('/Users/johnlindsay/Documents/data/aaa2.eigen', 'rb') as f: b = f.read()</p> <p>pt_features = np.frombuffer(b, dt)</p> <h2>Print the first 100 point features to demonstrate</h2> <p>for i in range(100): print(f"{pt_features['point_num'][i]} {pt_features['linearity'][i]} {pt_features['planarity'][i]} {pt_features['sphericity'][i]}")</p> <p>print("Done!") </code></p> <h2>References</h2> <p>Chehata, N., Guo, L., &amp; Mallet, C. (2009). Airborne lidar feature selection for urban classification using random forests. In Laser Scanning IAPRS, Vol. XXXVIII, Part 3/W8 – Paris, France, September 1-2, 2009.</p> <p>Gross, H., Jutzi, B., &amp; Thoennessen, U. (2007). Segmentation of tree regions using data of a full-waveform laser. International Archives of Photogrammetry, Remote Sensing and Spatial Information Sciences, 36(part 3), W49A.</p> <p>Niemeyer, J., Mallet, C., Rottensteiner, F., &amp; Sörgel, U. (2012). Conditional Random Fields for the Classification of LIDAR Point Clouds. In XXII ISPRS Congress at Melbourne, ISPRS Annals of the Photogrammetry, Remote Sensing and Spatial Information Sciences (Vol. 3).</p> <p>West, K. F., Webb, B. N., Lersch, J. R., Pothier, S., Triscari, J. M., &amp; Iverson, A. E. (2004). Context-driven automated target detection in 3D data. In Automatic Target Recognition XIV (Vol. 5426, pp. 133-143). SPIE.</p> <h2>See Also</h2> <p><a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#filter_lidar">filter_lidar</a>, <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#modify_lidar">modify_lidar</a>, <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#sort_lidar">sort_lidar</a>, <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#split_lidar">split_lidar</a></p>
<h2>Project Links</h2>
<div align="left">
    <a href="https://www.whiteboxgeo.com/whitebox-workflows-for-python/">WbW Homepage</a>
    <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/preface.html">User Manual</a>
    <a href="https://www.whiteboxgeo.com/wbw-purchase/">Support WbW</a>
</div>        

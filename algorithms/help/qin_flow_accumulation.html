<p>This tool is used to generate a flow accumulation grid (i.e. contributing area) using the Qin et al. (2007)  flow algorithm, not to be confused with the similarly named <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#quinn_flow_accumulation">quinn_flow_accumulation</a> tool. This algorithm is an  examples of a multiple-flow-direction (MFD) method because the flow entering each grid cell is routed to more  than one downslope neighbour, i.e. flow <em>divergence</em> is permitted. It is based on a modification of the Freeman (1991; <code>FD8FlowAccumulation</code>) and Quinn et al. (1995; <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#quinn_flow_accumulation">quinn_flow_accumulation</a>) methods. The Qin method relates  the degree of flow dispersion from a grid cell to the local maximum downslope gradient. Specifically, steeper  terrain experiences more convergent flow while flatter slopes experience more flow divergence. </p> <p>The following equations are used to calculate the portion flow (<em>F<sub>i</sub></em>) given to each neighbour, <em>i</em>:</p> <blockquote> <p><em>F<sub>i</sub></em> = <em>L<sub>i</sub></em>(tan&beta;)<sup><em>f(e)</em></sup> / &Sigma;<sub><em>i</em>=1</sub><sup><em>n</em></sup>[<em>L<sub>i</sub></em>(tan&beta;)<sup><em>f(e)</em></sup>]</p> <p><em>f(e)</em> = min(<em>e</em>, <em>e<sub>U</sub></em>) / <em>e<sub>U</sub></em> &times; (<em>p<sub>U</sub></em> - 1.1) + 1.1</p> </blockquote> <p>Where <em>L<sub>i</sub></em> is the contour length, and is 0.5&times;cell size for cardinal directions and 0.354&times;cell size for diagonal directions, <em>n</em> = 8, and represents each of the eight neighbouring grid cells. The exponent <em>f(e)</em> controls the proportion of flow allocated to each downslope neighbour of a grid cell, based on the local maximum downslope gradient (<em>e</em>), and the user-specified upper boundary of <em>e</em> (<em>e<sub>U</sub></em>; <code>max_slope</code>), and the upper  boundary of the exponent (<em>p<sub>U</sub></em>; <code>exponent</code>), <em>f(e)</em>. Note that the original Qin (2007) implementation allowed for user-specified lower boundaries on the slope (<em>e<sub>L</sub></em>) and exponent (<em>p<sub>L</sub></em>)  parameters as well. In this implementation, these parameters are assumed to be 0.0 and 1.1 respectively, and are not user adjustable. Also note, the <code>exponent</code> parameter should be less than 50.0, as higher values may cause numerical instability.</p> <p>The user must specify the  name (<code>dem</code>) of the input digital elevation model (DEM) and the output file (<code>output</code>).  The DEM must have been hydrologically corrected to remove all spurious depressions and flat areas. DEM  pre-processing is usually achieved using either the <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#breach_depressions_least_cost">breach_depressions_least_cost</a> (also <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#breach_depressions_least_cost">breach_depressions_least_cost</a>) or  <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#fill_depressions">fill_depressions</a> tool. </p> <p>The user-specified non-dispersive, channel initiation <em>threshold</em> (<code>threshold</code>) is a flow-accumulation  value (measured in upslope grid cells, which is directly proportional to area) above which flow dispersion is  no longer permitted. Grid cells with flow-accumulation values above this area threshold will have their flow routed in a manner that is similar to the D8 single-flow-direction algorithm, directing all flow towards the steepest downslope neighbour. This is usually done under the assumption that flow dispersion, whilst appropriate on hillslope areas, is not realistic once flow becomes channelized. Importantly, the <code>threshold</code> parameter sets  the spatial extent of the stream network, with lower values resulting in more extensive networks. </p> <p>In addition to the input DEM, output file (<code>output</code>), and exponent, the user must also specify the output type (<code>out_type</code>). The output flow-accumulation can be: 1) <code>cells</code> (i.e. the number of inflowing grid cells), <code>catchment area</code> (i.e. the upslope area), or <code>specific contributing area</code> (i.e. the catchment area divided by the flow width). The default value is <code>specific contributing area</code>. The user must also specify whether the output flow-accumulation grid should be log-tranformed (<code>log</code>), i.e. the output, if this option is selected, will be the natural-logarithm of the accumulated flow value. This is a transformation that is often performed to better visualize the contributing area distribution. Because contributing areas tend to be very high along valley bottoms and relatively low on hillslopes, when a flow-accumulation image is displayed, the distribution of values on hillslopes tends to be 'washed out' because the palette is stretched out to represent the highest values. Log-transformation provides a means of compensating for this phenomenon. Importantly, however, log-transformed flow-accumulation grids must not be used to estimate other secondary terrain indices, such as the wetness index (<a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#wetness_index">wetness_index</a>), or relative stream power index (<code>StreamPowerIndex</code>).</p> <h2>Reference</h2> <p>Freeman, T. G. (1991). Calculating catchment area with divergent flow based on a regular grid. Computers and Geosciences, 17(3), 413-422.</p> <p>Qin, C., Zhu, A. X., Pei, T., Li, B., Zhou, C., &amp; Yang, L. 2007. An adaptive approach to selecting a  flow‐partition exponent for a multiple‐flow‐direction algorithm. <em>International Journal of Geographical  Information Science</em>, 21(4), 443-458.</p> <p>Quinn, P. F., K. J. Beven, Lamb, R. 1995. The in (a/tanβ) index: How to calculate it and how to use it within  the topmodel framework. <em>Hydrological Processes</em> 9(2): 161-182.</p> <h2>See Also</h2> <p><code>D8FlowAccumulation</code>, <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#quinn_flow_accumulation">quinn_flow_accumulation</a>, <code>FD8FlowAccumulation</code>, <code>DInfFlowAccumulation</code>, <code>MDInfFlowAccumulation</code>, <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#rho8_pointer">rho8_pointer</a>, <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#wetness_index">wetness_index</a></p> <h2>Function Signature</h2> <p><code>def qin_flow_accumulation(self, dem: Raster, out_type: str = "sca", exponent: float = 10.0, max_slope: float = 45.0, convergence_threshold: float = float('inf'), log_transform: bool = False, clip: bool = False) -&gt; Raster: ... </code></p>
<h2>Project Links</h2>
<div align="left">
    <a href="https://www.whiteboxgeo.com/whitebox-workflows-for-python/">WbW Homepage</a>
    <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/preface.html">User Manual</a>
    <a href="https://www.whiteboxgeo.com/wbw-purchase/">Support WbW</a>
</div>        

<h2>Description</h2> <p>This tool implements a highly modified form of the DEM de-noising algorithm described by Sun et al. (2007). It is very effective at removing surface roughness from digital elevation models (DEMs), without significantly altering breaks-in-slope. As such, this tool should be used for smoothing DEMs rather than either smoothing with low-pass filters (e.g. mean, median, Gaussian filters) or grid size coarsening by resampling. The algorithm works by 1) calculating the surface normal 3D vector of each grid cell in the DEM, 2) smoothing the normal vector field using a filtering scheme that applies more weight to neighbours with lower angular difference in surface normal vectors, and 3) uses the smoothed normal vector field to update the elevations in the input DEM.</p> <p>Sun et al.'s (2007) original method was intended to work on input point clouds and fitted triangular irregular networks (TINs). The algorithm has been modified to work with input raster DEMs instead. In so doing, this algorithm calculates surface normal vectors from the planes fitted to 3 x 3 neighbourhoods surrounding each grid cell, rather than the triangular facet. The normal vector field smoothing and elevation updating procedures are also based on raster filtering operations. These modifications make this tool more efficient than Sun's original method, but will also result in a slightly different output than what would be achieved with Sun's method.</p> <p>The user must specify the values of three key parameters, including the filter size (<code>filter</code>), the normal difference threshold (<code>norm_diff</code>), and the number of iterations (<code>num_iter</code>). Lindsay et al. (2019) found that <strong>the degree of smoothing was less impacted by the filter size than it was either the normal difference threshold and the number of iterations</strong>. A filter size of 11, the default value, tends to work well in many cases. To increase the level of smoothing applied to the DEM, consider increasing the normal difference threshold, i.e. the angular difference in normal vectors between the center cell of a filter window and a neighbouring cell. This parameter determines which neighbouring values are included in a filtering operation and higher values will result in a greater number of neighbouring cells included, and therefore smoother surfaces. Similarly, increasing the number of iterations from the default value of 3 to upwards of 5-10 will result in significantly greater smoothing.</p> <p>Before smoothing treatment: <br/><img src="img/FeaturePreservingSmoothing_fig1.png" width="500"/></p> <p>After smoothing treatment with FPS: <br/><img src="img/FeaturePreservingSmoothing_fig2.png" width="500"/></p> <p>For a video tutorial on how to use the <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/tool_help.html#feature_preserving_smoothing">feature_preserving_smoothing</a> tool, please see <a href="https://www.youtube.com/watch?v=FM3It51L7ZA&amp;t=421s">this YouTube video</a>.</p> <h2>Reference</h2> <p>Lindsay JB, Francioni A, Cockburn JMH. 2019. LiDAR DEM smoothing and the preservation of drainage features. <em>Remote Sensing</em>, 11(16), 1926; DOI: 10.3390/rs11161926.</p> <p>Sun, X., Rosin, P., Martin, R., &amp; Langbein, F. (2007). Fast and effective feature-preserving mesh denoising. <em>IEEE Transactions on Visualization &amp; Computer Graphics</em>, (5), 925-938.</p> <h2>Parameters</h2> <p>dem (Raster):     The input digital elevation model (DEM)</p> <p>filter_size (int):     The filter size used for smoothing. Default is 11.</p> <p>normal_diff_threshold (float):     The maximum allowable difference in the angle of the normals between two grid cells on the same facet. Default is 8.0.</p> <p>iterations (int):     The number of iterations used during smoothing. Default is 3.</p> <p>max_elevation_diff (float):     The maximum allowable vertical distance that a cell's elevation is allowed to be changed by</p> <p>z_factor (float):     Used to convert elevation units so that they match the horizontal units. Unless the two units differ,      this should be set to 1.0. Default is 1.0.</p> <h2>Returns</h2> <p>Raster: return value</p> <h2>Function Signature</h2> <p><code>def feature_preserving_smoothing(self, dem: Raster, filter_size: int = 11, normal_diff_threshold: float = 8.0, iterations: int = 3, max_elevation_diff: float = float('inf'), z_factor: float = 1.0) -&gt; Raster: ... </code></p>
<h2>Project Links</h2>
<div align="left">
    <a href="https://www.whiteboxgeo.com/whitebox-workflows-for-python/">WbW Homepage</a>
    <a href="https://www.whiteboxgeo.com/manual/wbw-user-manual/book/preface.html">User Manual</a>
    <a href="https://www.whiteboxgeo.com/wbw-purchase/">Support WbW</a>
</div>        
